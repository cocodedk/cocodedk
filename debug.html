<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cytoscape Debug</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/cytoscape/3.24.0/cytoscape.min.js" referrerpolicy="no-referrer"></script>

  <!-- Load our CSS files -->
  <link rel="stylesheet" href="css/styles.css">
  <link rel="stylesheet" href="css/node-display.css">
  <link rel="stylesheet" href="css/cytoscape.css">

  <style>
    #debug-panel {
      margin: 20px 0;
      padding: 10px;
      background: #f0f0f0;
      border: 1px solid #ccc;
    }

    #load-actual-data {
      padding: 10px;
      background: #4CAF50;
      color: white;
      border: none;
      cursor: pointer;
      margin-bottom: 10px;
    }

    #toggle-implementation {
      padding: 10px;
      background: #2196F3;
      color: white;
      border: none;
      cursor: pointer;
      margin-bottom: 10px;
    }
  </style>
</head>
<body>
  <h1>Cytoscape Debug</h1>

  <div id="debug-panel">
    <button id="load-actual-data">Load Actual Data</button>
    <button id="toggle-implementation">Toggle Implementation</button>
    <div id="debug-output"></div>
  </div>

  <div id="cy-container"></div>

  <!-- First load a test implementation -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Create a simple Cytoscape instance with hardcoded data
      const cy = cytoscape({
        container: document.getElementById('cy-container'),
        style: [
          {
            selector: 'node',
            style: {
              'background-color': '#4CAF50',
              'label': 'data(label)',
              'color': '#fff',
              'text-valign': 'center',
              'text-halign': 'center',
              'width': 'data(size)',
              'height': 'data(size)'
            }
          },
          {
            selector: 'edge',
            style: {
              'width': 3,
              'line-color': '#ccc',
              'curve-style': 'bezier'
            }
          }
        ],
        elements: {
          nodes: [
            { data: { id: 'cocode', label: 'cocode.dk', size: 80 }, position: { x: 300, y: 300 } },
            { data: { id: 'software', label: 'Software', size: 60 }, position: { x: 300, y: 150 } },
            { data: { id: 'cyber', label: 'Cybersecurity', size: 60 }, position: { x: 300, y: 450 } },
            { data: { id: 'clients', label: 'Clients', size: 60 }, position: { x: 450, y: 300 } },
            { data: { id: 'contact', label: 'Contact', size: 60 }, position: { x: 150, y: 300 } }
          ],
          edges: [
            { data: { id: 'e1', source: 'cocode', target: 'software' } },
            { data: { id: 'e2', source: 'cocode', target: 'cyber' } },
            { data: { id: 'e3', source: 'cocode', target: 'clients' } },
            { data: { id: 'e4', source: 'cocode', target: 'contact' } }
          ]
        }
      });

      // Log to console
      console.log('Test Cytoscape initialized with nodes:', cy.nodes().length);

      // Set up event handlers
      document.getElementById('load-actual-data').addEventListener('click', function() {
        // Load our actual JavaScript files
        loadScripts([
          'js/nodes.js',
          'js/cytoscape-stylesheet.js',
          'js/cytoscape-edge-styles.js',
          'js/cytoscape-node-interactions.js',
          'js/cytoscape-edge-interactions.js',
          'js/cytoscape-accessibility.js',
          'js/cytoscape-manager.js'
        ], function() {
          initializeActualCytoscape();
        });
      });

      document.getElementById('toggle-implementation').addEventListener('click', function() {
        const container = document.getElementById('cy-container');
        // Destroy existing instance
        cy.destroy();

        // Check if our custom implementation is loaded
        if (window.CytoscapeManager) {
          // Reset to test implementation
          const debugOutput = document.getElementById('debug-output');
          debugOutput.innerHTML = '<p>Reverting to test implementation...</p>';

          // Create a new test instance
          const newCy = cytoscape({
            container: container,
            style: [
              {
                selector: 'node',
                style: {
                  'background-color': '#4CAF50',
                  'label': 'data(label)',
                  'color': '#fff',
                  'text-valign': 'center',
                  'text-halign': 'center',
                  'width': 'data(size)',
                  'height': 'data(size)'
                }
              },
              {
                selector: 'edge',
                style: {
                  'width': 3,
                  'line-color': '#ccc',
                  'curve-style': 'bezier'
                }
              }
            ],
            elements: {
              nodes: [
                { data: { id: 'cocode', label: 'cocode.dk', size: 80 }, position: { x: 300, y: 300 } },
                { data: { id: 'software', label: 'Software', size: 60 }, position: { x: 300, y: 150 } },
                { data: { id: 'cyber', label: 'Cybersecurity', size: 60 }, position: { x: 300, y: 450 } },
                { data: { id: 'clients', label: 'Clients', size: 60 }, position: { x: 450, y: 300 } },
                { data: { id: 'contact', label: 'Contact', size: 60 }, position: { x: 150, y: 300 } }
              ],
              edges: [
                { data: { id: 'e1', source: 'cocode', target: 'software' } },
                { data: { id: 'e2', source: 'cocode', target: 'cyber' } },
                { data: { id: 'e3', source: 'cocode', target: 'clients' } },
                { data: { id: 'e4', source: 'cocode', target: 'contact' } }
              ]
            }
          });
        } else {
          // Load our actual implementation
          loadScripts([
            'js/nodes.js',
            'js/cytoscape-stylesheet.js',
            'js/cytoscape-edge-styles.js',
            'js/cytoscape-node-interactions.js',
            'js/cytoscape-edge-interactions.js',
            'js/cytoscape-accessibility.js',
            'js/cytoscape-manager.js'
          ], function() {
            initializeActualCytoscape();
          });
        }
      });
    });

    // Helper function to load scripts
    function loadScripts(scripts, callback) {
      let loadedCount = 0;
      const debugOutput = document.getElementById('debug-output');

      debugOutput.innerHTML = '<p>Loading scripts...</p>';

      scripts.forEach(function(src) {
        const script = document.createElement('script');
        script.src = src;
        script.onload = function() {
          loadedCount++;
          debugOutput.innerHTML += `<p>Loaded: ${src}</p>`;

          if (loadedCount === scripts.length) {
            callback();
          }
        };
        script.onerror = function() {
          debugOutput.innerHTML += `<p>Error loading: ${src}</p>`;
        };
        document.head.appendChild(script);
      });
    }

    // Initialize our actual Cytoscape implementation
    function initializeActualCytoscape() {
      const debugOutput = document.getElementById('debug-output');
      debugOutput.innerHTML += '<p>Initializing actual Cytoscape implementation...</p>';

      try {
        // Check if required objects are available
        if (!window.CytoscapeManager) {
          debugOutput.innerHTML += '<p>Error: CytoscapeManager not available!</p>';
          return;
        }

        if (!window.nodes || !window.links) {
          debugOutput.innerHTML += '<p>Error: nodes or links data not available!</p>';
          return;
        }

        // Initialize Cytoscape manager
        const cy = window.CytoscapeManager.initialize('cy-container');
        if (!cy) {
          debugOutput.innerHTML += '<p>Error: Failed to initialize Cytoscape!</p>';
          return;
        }

        // Load graph data
        window.CytoscapeManager.loadNodesJsGraph(window.nodes, window.links, {
          language: 'en',
          responsive: true
        });

        // Check if nodes were added
        const nodeCount = cy.nodes().length;
        debugOutput.innerHTML += `<p>Nodes added to Cytoscape: ${nodeCount}</p>`;

        if (nodeCount === 0) {
          // Try to add a test node
          try {
            cy.add({
              group: 'nodes',
              data: { id: 'test-node', label: 'Test Node' },
              position: { x: 100, y: 100 }
            });

            const newCount = cy.nodes().length;
            debugOutput.innerHTML += `<p>Test node added. New count: ${newCount}</p>`;

            // Force layout update
            cy.layout({ name: 'preset' }).run();
            cy.fit();
            cy.center();
          } catch (e) {
            debugOutput.innerHTML += `<p>Error adding test node: ${e.message}</p>`;
          }
        } else {
          // Run layout
          cy.layout({ name: 'preset' }).run();
          cy.fit();
          cy.center();
          debugOutput.innerHTML += '<p>Layout applied and view centered</p>';
        }

        debugOutput.innerHTML += '<p>Initialization complete!</p>';
      } catch (e) {
        debugOutput.innerHTML += `<p>Error: ${e.message}</p>`;
        console.error('Error initializing:', e);
      }
    }
  </script>
</body>
</html>
